{%load static%}

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>맞춤 식단 결과</title>
    <link rel="stylesheet" href="{% static 'css/results.css' %}">
</head>
<body>
    <!-- Header -->
    <header class="header-section">
        <div class="header-content">
            <h1>Nutri<span class="stylized-name">Life</span></h1>
            <p>맞춤형 식단 추천 결과를 확인하세요</p>
        </div>
        <div class="header-image">
            <!-- <img src="/media/logo.png" alt="NutriLife 로고"> -->
        </div>
    </header>

    <main>
        <!-- 에너지 통계 섹션 -->
        <section class="energy-stats">
            <h2>에너지 통계</h2>
            <div class="stats-container">
                <!-- BMR -->
                <div class="stat-item bmr">
                    <h3>기초대사량 (BMR)</h3>
                    <div class="stat-value">
                        <span>{{ bmr }}</span> kcal
                    </div>
                    <p>하루 생존에 필요한 최소 에너지</p>
                </div>
                <!-- TDEE -->
                <div class="stat-item tdee">
                    <h3>총 일일 에너지 소비량 (TDEE)</h3>
                    <div class="stat-value">
                        <span>{{ tdee }}</span> kcal
                    </div>
                    <p>운동, 활동량 등을 포함한 하루 에너지 소모량</p>
                </div>
            </div>

            <!-- 매크로 목표 -->
            <div class="macro-goals">
                <h3>일일 섭취 목표</h3>
                <div class="macro-container">
                    <div class="macro-item carbs">
                        <h4>탄수화물</h4>
                        <span>{{ daily_macros.carbs|floatformat:1 }}</span> kcal
                    </div>
                    <div class="macro-item protein">
                        <h4>단백질</h4>
                        <span>{{ daily_macros.protein|floatformat:1 }}</span> kcal
                    </div>
                    <div class="macro-item fats">
                        <h4>지방</h4>
                        <span>{{ daily_macros.fats|floatformat:1 }}</span> kcal
                    </div>
                </div>
            </div>
            <div class="refresh-button-container">
                <button id="refresh-meal-btn">새로고침</button>
            </div>
        </section>

        <!-- 식단 섹션 -->
        <section class="meal-section">
            <h2>식단</h2>
            {% for meal in meals %}
                <div class="meal-container">
                    <h3>{{ meal.meal_time|capfirst }}</h3>
                    <div class="meal-tray">
                        <div class="tray carbs">
                            <h4>탄수화물</h4>
                            <ul>
                                {% for carb in meal.meal.additional_carbs %}
                                    <li>{{ carb.name }}: {{ carb.amount }}g</li>
                                {% endfor %}
                            </ul>
                        </div>
                        <div class="tray protein">
                            <h4>단백질</h4>
                            <ul>
                                {% for protein in meal.meal.additional_protein %}
                                    <li>{{ protein.name }}: {{ protein.amount }}g</li>
                                {% endfor %}
                            </ul>
                        </div>
                        <div class="tray fats">
                            <h4>지방</h4>
                            <ul>
                                {% for fat in meal.meal.additional_fats %}
                                    <li>{{ fat.name }}: {{ fat.amount }}g</li>
                                {% endfor %}
                            </ul>
                        </div>
                        <div class="tray ready-meal">
                            <h4>완제품</h4>
                            <ul>
                                <li>{{ meal.meal.ready_meal.name }}: {{ meal.meal.ready_meal.amount }}g</li>
                            </ul>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </section>
    </main>
    <script>
        document.getElementById("refresh-meal-btn").addEventListener("click", function () {
            fetch("/user_info/refresh_meals/", {
                method: "POST",
                headers: {
                    "X-CSRFToken": "{{ csrf_token }}"
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // 페이지를 다시 로드하여 업데이트된 결과 표시
                    location.reload();
                } else {
                    alert("식단 새로고침에 실패했습니다. 다시 시도해주세요.");
                }
            });
        });
    </script>
</body>
</html>